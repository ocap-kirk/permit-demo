"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ContextStore = void 0;
/**
 * Store for contexted passed as part of check() queries
 */
class ContextStore {
    constructor() {
        this.baseContext = {}; // cross-query context (global context)
        this.transforms = [];
    }
    /**
     * add context to the base context
     */
    add(context) {
        this.baseContext = Object.assign(this.baseContext, context);
    }
    registerTransform(transform) {
        this.transforms.push(transform);
    }
    /**
     * merges the global context (this.context) with the context
     * provided for this specific query (context). the specific
     * context overrides the base (global) context.
     */
    getDerivedContext(context) {
        return Object.assign({}, this.baseContext, context);
    }
    transform(initialContext) {
        let context = Object.assign({}, initialContext);
        for (const transform of this.transforms) {
            context = transform(context);
        }
        return context;
    }
}
exports.ContextStore = ContextStore;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9jb250ZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQWFBOztHQUVHO0FBQ0gsTUFBYSxZQUFZO0lBQXpCO1FBQ1UsZ0JBQVcsR0FBWSxFQUFFLENBQUMsQ0FBQyx1Q0FBdUM7UUFDbEUsZUFBVSxHQUF1QixFQUFFLENBQUM7SUE2QjlDLENBQUM7SUEzQkM7O09BRUc7SUFDSSxHQUFHLENBQUMsT0FBZ0I7UUFDekIsSUFBSSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUVNLGlCQUFpQixDQUFDLFNBQTJCO1FBQ2xELElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksaUJBQWlCLENBQUMsT0FBZ0I7UUFDdkMsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFTSxTQUFTLENBQUMsY0FBdUI7UUFDdEMsSUFBSSxPQUFPLHFCQUFRLGNBQWMsQ0FBRSxDQUFDO1FBQ3BDLEtBQUssTUFBTSxTQUFTLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUN2QyxPQUFPLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQzlCO1FBQ0QsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztDQUNGO0FBL0JELG9DQStCQyJ9